services:
  api:
    depends_on:
      database:
        condition: service_healthy
    healthcheck:
      test: [ "CMD-SHELL", "netstat -an | grep :9000 || exit 1" ]
      interval: 6s
      timeout: 6s
      retries: 40
    environment:
      # LARAVEL SPECIFICS
      APP_NAME: ${APP_NAME}
      APP_ENV: ${ENV}
      APP_DEBUG: ${DEBUG}
      APP_URL: ${HTTP_PROTOCOL}://${DOMAIN}
      HTTP_PROTOCOL: ${HTTP_PROTOCOL}
      SANCTUM_STATEFUL_DOMAINS: ${SANCTUM_STATEFUL_DOMAINS}
      CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS}
      SESSION_DOMAIN: .${DOMAIN}
      # DATABASE
      DB_DATABASE: ${DATABASE_NAME}
      DB_USERNAME: ${DATABASE_USER}
      DB_PASSWORD: ${DATABASE_PASSWORD}
      DB_HOST: database
      # EMAILING
      MAIL_USERNAME: ${MAIL_USERNAME}
      MAIL_PASSWORD: ${MAIL_PASSWORD}
      MAIL_MAILER: ${MAIL_MAILER}
      MAIL_HOST: ${MAIL_HOST}
      MAIL_PORT: ${MAIL_PORT}
      MAIL_ENCRYPTION: ${MAIL_ENCRYPTION}
      MAIL_FROM_ADDRESS: ${MAIL_FROM_ADDRESS}
      MAIL_FROM_NAME: ${MAIL_FROM_NAME}
      MAIL_VERIFY_PEER: ${MAIL_VERIFY_PEER}
      # GRADES
      ACCESS_PLAN_FREE_GRADE: ${ACCESS_PLAN_FREE_GRADE}
      TOKEN_BALANCE_FREE_GRADE: ${TOKEN_BALANCE_FREE_GRADE}
      CASHBACK_FREE_GRADE: ${CASHBACK_FREE_GRADE}
      EFFICIENCY_FREE_GRADE: ${EFFICIENCY_FREE_GRADE}
      ACCESS_PLAN_FIRST_GRADE: ${ACCESS_PLAN_FIRST_GRADE}
      TOKEN_BALANCE_FIRST_GRADE: ${TOKEN_BALANCE_FIRST_GRADE}
      CASHBACK_FIRST_GRADE: ${CASHBACK_FIRST_GRADE}
      EFFICIENCY_FIRST_GRADE: ${EFFICIENCY_FIRST_GRADE}
      ACCESS_PLAN_SECOND_GRADE: ${ACCESS_PLAN_SECOND_GRADE}
      TOKEN_BALANCE_SECOND_GRADE: ${TOKEN_BALANCE_SECOND_GRADE}
      CASHBACK_SECOND_GRADE: ${CASHBACK_SECOND_GRADE}
      EFFICIENCY_SECOND_GRADE: ${EFFICIENCY_SECOND_GRADE}
      ACCESS_PLAN_THIRD_GRADE: ${ACCESS_PLAN_THIRD_GRADE}
      TOKEN_BALANCE_THIRD_GRADE: ${TOKEN_BALANCE_THIRD_GRADE}
      CASHBACK_THIRD_GRADE: ${CASHBACK_THIRD_GRADE}
      EFFICIENCY_THIRD_GRADE: ${EFFICIENCY_THIRD_GRADE}

  api_webserver:
    depends_on:
      api:
        condition: service_healthy

  api_cron:
    extends: api
    depends_on:
      api:
        condition: service_healthy
